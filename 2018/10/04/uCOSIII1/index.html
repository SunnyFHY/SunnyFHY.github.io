<!DOCTYPE html>
<html lang="null">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="符涵月">
  <meta name="description" content="南邮本科生">
  
  <title>SunnyFHY</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<link rel="shortcut icon" href="/source/favicon.ico">
</head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/Coconutree_Moon.jpg);background-color:#26A69A">
    <div class="header-box"><img src="/images/Spongebob.jpg" ondragstart="return false;"></div>
    <p>SunnyFHY</p>
    <div class="nav-link">
        
        
        <a  href="https://github.com/SunnyFHY" target="_blank"><div class="link-box github"></div></a>
        
        
        
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class='no-result'>无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2018/10/">October 2018<span class="archive-count">3</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a   class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/VivadoHLS/">VivadoHLS<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/四旋翼/">四旋翼<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/操作系统/">操作系统<span class="category-count">1</span></a>
    </li>
</ul>
<!--tags-->

<!--photo-->

<!--friends-->

<!--about-->

<li class="nav-list">
    <a href="/about" target="_self">
        <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>关于</p>
    </a>
</li>


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#26A69A;background-image:url(/images/random/vateral-13.png)" >
  <h2>uCOSIII(一)</h2>
    
  <p>作者:SunnyFHY &nbsp&nbsp 发布于:<time datetime="2018-10-04T12:48:24.000Z">
          2018-10-04
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <h1 id="UCOSIII学习"><a href="#UCOSIII学习" class="headerlink" title="UCOSIII学习"></a>UCOSIII学习</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>学了一年单片机，从51到tm4以及stm32,基本都是在while(1)里面“裸奔”。18年暑假的时候突然想玩一下操作系统，就操作了一下。原来有一个官方移植的tm4c1294例程。本来是想改一改移植到tm4c123g上然后用ccs作为开发环境，研究了一天发现micrium官方对于tiva-c系列只提供了IAR和realview开发工具的startup.c。我猜直接把ccs的startup_ccs.c换掉realview的或许可以吧。不过我的首要目的是学单片机上操作系统的原理和使用方法，所以就直接用官方移植的例程上手了。</p>
<h2 id="基于tm4c1294的UCOSIII系统搭建"><a href="#基于tm4c1294的UCOSIII系统搭建" class="headerlink" title="基于tm4c1294的UCOSIII系统搭建"></a>基于tm4c1294的UCOSIII系统搭建</h2><h3 id="官方例程下载"><a href="#官方例程下载" class="headerlink" title="官方例程下载"></a>官方例程下载</h3><h3 id="1-进入micrium官网"><a href="#1-进入micrium官网" class="headerlink" title="1.进入micrium官网"></a>1.进入micrium官网</h3><p>国外网站打开有点慢，等个半分钟到一分钟就行。</p>
<p><a href="https://www.micrium.com/" target="_blank" rel="external">https://www.micrium.com/</a></p>
<p><img src="/2018/10/04/uCOSIII1/1538641804364.png" alt="1538641804364"></p>
<h3 id="2-点击导航栏的Downloads进入下载页面"><a href="#2-点击导航栏的Downloads进入下载页面" class="headerlink" title="2.点击导航栏的Downloads进入下载页面"></a>2.点击导航栏的Downloads进入下载页面</h3><p>下拉页面找到根据MCU生产商浏览，找到Texas Instrument。</p>
<p><img src="/2018/10/04/uCOSIII1/1538642099029.png" alt="1538642099029"></p>
<h3 id="3-选中tm4c1294进入下载界面"><a href="#3-选中tm4c1294进入下载界面" class="headerlink" title="3.选中tm4c1294进入下载界面"></a>3.选中tm4c1294进入下载界面</h3><p><img src="/2018/10/04/uCOSIII1/1538642588422.png" alt="1538642588422"></p>
<h3 id="4-直接点击资源这一栏"><a href="#4-直接点击资源这一栏" class="headerlink" title="4.直接点击资源这一栏"></a>4.直接点击资源这一栏</h3><p>值得注意的是micrium提供的keil MDK是v4，所以导入到v5会有警告提示，管它呢。反正最后不影响使用就是了。</p>
<p><img src="/2018/10/04/uCOSIII1/1538642688315.png" alt="1538642688315"></p>
<h3 id="5-登录账号并下载"><a href="#5-登录账号并下载" class="headerlink" title="5.登录账号并下载"></a>5.登录账号并下载</h3><p>注册一个micrium账号，Log in to Download</p>
<p><img src="/2018/10/04/uCOSIII1/1538643022452.png" alt="1538643022452"></p>
<h3 id="文件结构解析"><a href="#文件结构解析" class="headerlink" title="文件结构解析"></a>文件结构解析</h3><h4 id="文件夹初探"><a href="#文件夹初探" class="headerlink" title="文件夹初探"></a>文件夹初探</h4><p>文件夹解压出来如下</p>
<p><img src="/2018/10/04/uCOSIII1/1538643201614.png" alt="1538643201614"></p>
<h5 id="第一个EvalBoards就是MCU板子移植的相关代码"><a href="#第一个EvalBoards就是MCU板子移植的相关代码" class="headerlink" title="第一个EvalBoards就是MCU板子移植的相关代码"></a>第一个EvalBoards就是MCU板子移植的相关代码</h5><p>我们要找的keil工程文件在EvalBoards-&gt;TI-&gt;EK-TM4C1294XL-&gt;OS3-&gt;KeilMDK这条路径下。</p>
<p>在OS3那一层并列一个”BSP”的文件夹，这是micrium写的tm4c1294板子驱动的相关代码。不过我采用的是tiva-ware，这个BSP驱动后续可能只用一部分，不然会重定义然后打架。</p>
<p><img src="/2018/10/04/uCOSIII1/1538643385032.png" alt="1538643385032"></p>
<h5 id="剩下三个就是UCOSIII的资源文件"><a href="#剩下三个就是UCOSIII的资源文件" class="headerlink" title="剩下三个就是UCOSIII的资源文件"></a>剩下三个就是UCOSIII的资源文件</h5><p>这部分详细介绍参考《嵌入式实时操作系统uCOS-3》（北航出版社）。</p>
<p><strong>uC-CPU</strong></p>
<p>文件结构如下</p>
<p>\uC-CPU</p>
<p>​    \cpu_core.c(包含适用所有CPU架构的C代码 包含用来测量中断关闭时间的函数)</p>
<p>​    \cpu_core.h（包含用于测量中断关闭时间的变量定义）</p>
<p>​    \cpu_def.h（包含uC/CPU模块使用的宏定义）</p>
<p>​    \ARM-Cortex-M4\RealView</p>
<p>​        \cpu.h(包含一些数据类型定义)</p>
<p>​        \cpu_a.asm（汇编语言实现开关中断、计算前导零、使能缓存、建立MPUs、MMU的函数，其中函数可以直接在C代码里调用）</p>
<p>​        \cpu_c.c（基于特定cpu架构的代码）</p>
<p><strong>uC-LIB</strong></p>
<p>可移植库函数如下</p>
<p>\lib_ascii.c及其头文件（其中函数可以替代大小字母转化和数字字母互化的库函数）</p>
<p>\lib_def.h(定义许多常量)</p>
<p>\lib_math.c及其头文件（其中函数可以替代rand()、srand()）</p>
<p>\lib_mem.c及其头文件（其中函数可以替代memclr()、memset()、memcpy()、memcmp()）等</p>
<p>lib_str.c及其头文件（其中函数可以以替代strlen()、strcpy()、strcmp()）等</p>
<p><strong>uCOS-III</strong></p>
<p>其中与处理器类型无关文件如下</p>
<p>\Source</p>
<p>​    \os_cfg.app.c（根据os_cfg_app.h中宏定义定义变量和数据）</p>
<p>​    \os_core.c（包含uCOSIII内核功能模块）</p>
<p>​    \os_dbg.c（包含内核调试器）</p>
<p>​    \os_flag.c（包含事件标志管理代码）</p>
<p>​    \os_int.c（包含中断处理任务代码）</p>
<p>​    \os_mem.c（包含存储分区代码）</p>
<p>​    \os_msg.c（包含消息处理代码）</p>
<p>​    \os_mutex.c（包含互斥信号量代码）</p>
<p>​    \os_pend.multi.c（包含允许任务同时等待多个信号量和多个消息队列代码）</p>
<p>​    \os_prio.c（用于追踪已就绪任务）</p>
<p>​    \os_q.c（包含消息队列管理代码）</p>
<p>​    \os_sem.c（包含信号量管理代码）</p>
<p>​    \os_stat.c(包含统计任务代码)</p>
<p>​    \os_task.c（包含任务的管理代码）</p>
<p>​    \os_tick.c（包含可管理正在延时和超时等待任务）</p>
<p>​    \os_time.c（包含延时代码）</p>
<pre><code>\os_tmr.c（包含软件定时器代码）
</code></pre><p>​    \os_var.c（包含uCOSIII的全局变量）</p>
<p>​    \os.h（uCOSIII主要头文件）</p>
<p>​    \os_type.h（包含数据类型声明）</p>
<h3 id="keil环境配置"><a href="#keil环境配置" class="headerlink" title="keil环境配置"></a>keil环境配置</h3><p>在第一次导入工程的时候一般会提示识别到器件为tm4c1294,直接按提示下支持包就行。</p>
<p>器件型号为TM4C1294NCPDT。</p>
<p>我记得只要器件型号对上了，其他配置在这个例程下基本都是配好的。</p>
<p>只需要在魔术棒的C/C++选项卡把Preprocessor Symbols的Define填上     rvmdk PART_TM4C1294NCPDT     就行。<img src="/2018/10/04/uCOSIII1/1538653394096.png" alt="1538653394096"></p>
<p>如果出现什么问题，参照以下文档配置keil下的tm4开发环境：</p>
<p><a href="https://wenku.baidu.com/view/6d23b80dbc64783e0912a21614791711cc7979f4.html" target="_blank" rel="external">https://wenku.baidu.com/view/6d23b80dbc64783e0912a21614791711cc7979f4.html</a></p>
<h3 id="tiva-ware联动"><a href="#tiva-ware联动" class="headerlink" title="tiva-ware联动"></a>tiva-ware联动</h3><p>tiva-ware是一个ti的软件开发包，里面有bsp板级支持以及tiva-c系列各型号开发板的库函数和例程。</p>
<p>在keil里面使用tiva-ware只需要将tiva-ware包里面针对realview开发工具的driverlib.lib添入工程就行。</p>
<p>顺便在魔术棒的C/C++选项卡里的 Include Paths一栏加入你的tiva-ware包的路径。</p>
<p><img src="/2018/10/04/uCOSIII1/1538653571710.png" alt="1538653571710"></p>
<h2 id="第一个UCOSIII工程"><a href="#第一个UCOSIII工程" class="headerlink" title="第一个UCOSIII工程"></a>第一个UCOSIII工程</h2><p>下好例程，配好环境，来试试水</p>
<p>软件设计如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"app_cfg.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;cpu_core.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;os.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"..\bsp\bsp.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"..\bsp\bsp_led.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"..\bsp\bsp_sys.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">"..\bsp\bsp_misc.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;lib_ascii.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;lib_math.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;lib_mem.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;lib_str.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"inc/hw_memmap.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"driverlib/gpio.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"driverlib/sysctl.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> START_TASK_PRIO		3	</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> START_STK_SIZE 		128</span></div><div class="line">OS_TCB StartTaskTCB;	</div><div class="line">CPU_STK START_TASK_STK[START_STK_SIZE];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">start_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK1_TASK_PRIO		4	</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK1_STK_SIZE 		128</span></div><div class="line">OS_TCB Task1_TaskTCB	</div><div class="line">CPU_STK TASK1_TASK_STK[TASK1_STK_SIZE];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">task1_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK2_TASK_PRIO		5</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TASK2_STK_SIZE 		128</span></div><div class="line">OS_TCB Task2_TaskTCB;</div><div class="line">CPU_STK TASK2_TASK_STK[TASK2_STK_SIZE];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">task2_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">    OS_ERR  err;</div><div class="line">    CPU_SR_ALLOC();                                              <span class="comment">/* Disable all interrupts.*/</span></div><div class="line">    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOF);</div><div class="line">    <span class="keyword">while</span>(!SysCtlPeripheralReady(SYSCTL_PERIPH_GPIOF))</div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    GPIOPinTypeGPIOOutput(GPIO_PORTF_BASE, GPIO_PIN_0|GPIO_PIN_4);</div><div class="line">    OSInit(&amp;err);                                               <span class="comment">/* Init uC/OS-III. */</span></div><div class="line">    OS_CRITICAL_ENTER();</div><div class="line">   OSTaskCreate((OS_TCB 	* )&amp;StartTaskTCB,		</div><div class="line">				 (CPU_CHAR	* )<span class="string">"start task"</span>, 	</div><div class="line">                 (OS_TASK_PTR )start_task, 			</div><div class="line">                 (<span class="keyword">void</span>		* )<span class="number">0</span>,					</div><div class="line">                 (OS_PRIO	  )START_TASK_PRIO,     </div><div class="line">                 (CPU_STK   * )&amp;START_TASK_STK[<span class="number">0</span>],	</div><div class="line">                 (CPU_STK_SIZE)START_STK_SIZE/<span class="number">10</span>,	</div><div class="line">                 (CPU_STK_SIZE)START_STK_SIZE,		</div><div class="line">                 (OS_MSG_QTY  )<span class="number">0</span>,					</div><div class="line">                 (OS_TICK	  )<span class="number">0</span>,					</div><div class="line">                 (<span class="keyword">void</span>   	* )<span class="number">0</span>,					</div><div class="line">                 (OS_OPT      )OS_OPT_TASK_STK_CHK|OS_OPT_TASK_STK_CLR|OS_OPT_TASK_SAVE_FP, </div><div class="line">                 (OS_ERR 	* )&amp;err);				</div><div class="line">	OS_CRITICAL_EXIT();		 </div><div class="line">	OSStart(&amp;err);      </div><div class="line"></div><div class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</div><div class="line">			&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">start_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span></div><div class="line">&#123;</div><div class="line">	CPU_INT32U  cpu_clk_freq;</div><div class="line">    CPU_INT32U  cnts;</div><div class="line">	OS_ERR err;</div><div class="line">	CPU_SR_ALLOC();</div><div class="line">	</div><div class="line"></div><div class="line"></div><div class="line">   (<span class="keyword">void</span>)&amp;p_arg;</div><div class="line"></div><div class="line">    BSP_Init();                                           <span class="comment">/* Initialize BSP functions */</span></div><div class="line"></div><div class="line">    cpu_clk_freq = BSP_SysClkFreqGet();                <span class="comment">/* Determine SysTick reference freq.*/</span></div><div class="line">    cnts         = cpu_clk_freq                          <span class="comment">/* Determine nbr SysTick increments*/</span></div><div class="line">                 / (CPU_INT32U)OSCfg_TickRate_Hz;</div><div class="line"></div><div class="line">    OS_CPU_SysTickInit(cnts);</div><div class="line">    CPU_Init();  </div><div class="line">	</div><div class="line"></div><div class="line">	OS_CRITICAL_ENTER();	</div><div class="line">	OSTaskCreate((OS_TCB 	* )&amp;Task1_TaskTCB,		</div><div class="line">				 (CPU_CHAR	* )<span class="string">"Task1 task"</span>, 		</div><div class="line">                 (OS_TASK_PTR )task1_task, 			</div><div class="line">                 (<span class="keyword">void</span>		* )<span class="number">0</span>,					</div><div class="line">                 (OS_PRIO	  )TASK1_TASK_PRIO,     </div><div class="line">                 (CPU_STK   * )&amp;TASK1_TASK_STK[<span class="number">0</span>],	</div><div class="line">                 (CPU_STK_SIZE)TASK1_STK_SIZE/<span class="number">10</span>,	</div><div class="line">                 (CPU_STK_SIZE)TASK1_STK_SIZE,		</div><div class="line">                 (OS_MSG_QTY  )<span class="number">0</span>,					</div><div class="line">                 (OS_TICK	  )<span class="number">0</span>,					</div><div class="line">                 (<span class="keyword">void</span>   	* )<span class="number">0</span>,					</div><div class="line">                 (OS_OPT      )OS_OPT_TASK_STK_CHK|OS_OPT_TASK_STK_CLR|OS_OPT_TASK_SAVE_FP,</div><div class="line">                 (OS_ERR 	* )&amp;err);				</div><div class="line">				 </div><div class="line">	</div><div class="line">	OSTaskCreate((OS_TCB 	* )&amp;Task2_TaskTCB,		</div><div class="line">				 (CPU_CHAR	* )<span class="string">"task2 task"</span>, 		</div><div class="line">                 (OS_TASK_PTR )task2_task, 			</div><div class="line">                 (<span class="keyword">void</span>		* )<span class="number">0</span>,					</div><div class="line">                 (OS_PRIO	  )TASK2_TASK_PRIO,     	</div><div class="line">                 (CPU_STK   * )&amp;TASK2_TASK_STK[<span class="number">0</span>],	</div><div class="line">                 (CPU_STK_SIZE)TASK2_STK_SIZE/<span class="number">10</span>,	</div><div class="line">                 (CPU_STK_SIZE)TASK2_STK_SIZE,		</div><div class="line">                 (OS_MSG_QTY  )<span class="number">0</span>,					</div><div class="line">                 (OS_TICK	  )<span class="number">0</span>,					</div><div class="line">                 (<span class="keyword">void</span>   	* )<span class="number">0</span>,				</div><div class="line">                 (OS_OPT      )OS_OPT_TASK_STK_CHK|OS_OPT_TASK_STK_CLR|OS_OPT_TASK_SAVE_FP, </div><div class="line">                 (OS_ERR 	* )&amp;err);			 </div><div class="line">	OS_CRITICAL_EXIT();	</div><div class="line">								 </div><div class="line">	OSTaskDel((OS_TCB*)<span class="number">0</span>,&amp;err);	</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">task1_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span></div><div class="line">&#123;</div><div class="line">	CPU_INT08U task1_num=<span class="number">0</span>;</div><div class="line">	CPU_INT32U ui32Loop1;</div><div class="line">	OS_ERR err;</div><div class="line">	CPU_SR_ALLOC();</div><div class="line">	p_arg = p_arg;</div><div class="line">	</div><div class="line">	</div><div class="line">	OS_CRITICAL_ENTER();</div><div class="line">	</div><div class="line">	OS_CRITICAL_EXIT();</div><div class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		task1_num++;	</div><div class="line">		 <span class="comment">//BSP_LED_Toggle(1);</span></div><div class="line">        GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_4, GPIO_PIN_4);</div><div class="line">        <span class="keyword">for</span>(ui32Loop1 = <span class="number">0</span>; ui32Loop1 &lt; <span class="number">20000</span>; ui32Loop1++)</div><div class="line">        &#123;</div><div class="line">        &#125;</div><div class="line">				</div><div class="line">        GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_4, <span class="number">0x0</span>);</div><div class="line">        <span class="keyword">for</span>(ui32Loop1 = <span class="number">0</span>; ui32Loop1 &lt; <span class="number">20000</span>; ui32Loop1++)</div><div class="line">        &#123;</div><div class="line">        &#125;</div><div class="line">		<span class="keyword">if</span>(task1_num==<span class="number">5</span>) </div><div class="line">		&#123;</div><div class="line">			OSTaskDel((OS_TCB*)&amp;Task2_TaskTCB,&amp;err);	</div><div class="line">			</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	</div><div class="line">		OSTimeDlyHMSM(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,OS_OPT_TIME_HMSM_STRICT,&amp;err); </div><div class="line">		</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">task2_task</span><span class="params">(<span class="keyword">void</span> *p_arg)</span></span></div><div class="line">&#123;</div><div class="line">	CPU_INT08U task2_num=<span class="number">0</span>;</div><div class="line">	CPU_INT32U ui32Loop;</div><div class="line">	OS_ERR err;</div><div class="line">	CPU_SR_ALLOC();</div><div class="line">	p_arg = p_arg;</div><div class="line">	</div><div class="line">	</div><div class="line">	OS_CRITICAL_ENTER();</div><div class="line">	</div><div class="line">	OS_CRITICAL_EXIT();</div><div class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		task2_num++;	</div><div class="line">     <span class="comment">//BSP_LED_Toggle(2);  </span></div><div class="line">	</div><div class="line">       GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_0, GPIO_PIN_0);</div><div class="line">        <span class="keyword">for</span>(ui32Loop = <span class="number">0</span>; ui32Loop &lt; <span class="number">20000</span>; ui32Loop++)</div><div class="line">        &#123;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_0, <span class="number">0x0</span>);</div><div class="line">        <span class="keyword">for</span>(ui32Loop = <span class="number">0</span>; ui32Loop &lt; <span class="number">20000</span>; ui32Loop++)</div><div class="line">        &#123;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">		OSTimeDlyHMSM(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,OS_OPT_TIME_HMSM_STRICT,&amp;err); </div><div class="line">			&#125;	</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>下载现象为：任务一运行5次后删掉任务二。所以可以看到本来是两个led几乎同时闪烁，闪烁4次后，有一个led停止闪烁，另一个继续闪烁。</p>
<p>至此，你就在tm4c1294上拥有了一个基于tiva-ware固件库可以跑的uCOSIII。</p>

  </div>
  <!--评论块-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2018/10/06/vivadoHLS-0/" id="post_nav-newer" class="post-nav-content prev-content">
      新篇
  </a>
    


  <!-- Next Nav -->
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#UCOSIII学习"><span class="post-toc-number">1.</span> <span class="post-toc-text">UCOSIII学习</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基于tm4c1294的UCOSIII系统搭建"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">基于tm4c1294的UCOSIII系统搭建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#官方例程下载"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">官方例程下载</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-进入micrium官网"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">1.进入micrium官网</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-点击导航栏的Downloads进入下载页面"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">2.点击导航栏的Downloads进入下载页面</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-选中tm4c1294进入下载界面"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">3.选中tm4c1294进入下载界面</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-直接点击资源这一栏"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">4.直接点击资源这一栏</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-登录账号并下载"><span class="post-toc-number">1.2.6.</span> <span class="post-toc-text">5.登录账号并下载</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件结构解析"><span class="post-toc-number">1.2.7.</span> <span class="post-toc-text">文件结构解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#文件夹初探"><span class="post-toc-number">1.2.7.1.</span> <span class="post-toc-text">文件夹初探</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#第一个EvalBoards就是MCU板子移植的相关代码"><span class="post-toc-number">1.2.7.1.1.</span> <span class="post-toc-text">第一个EvalBoards就是MCU板子移植的相关代码</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#剩下三个就是UCOSIII的资源文件"><span class="post-toc-number">1.2.7.1.2.</span> <span class="post-toc-text">剩下三个就是UCOSIII的资源文件</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#keil环境配置"><span class="post-toc-number">1.2.8.</span> <span class="post-toc-text">keil环境配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#tiva-ware联动"><span class="post-toc-number">1.2.9.</span> <span class="post-toc-text">tiva-ware联动</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#第一个UCOSIII工程"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">第一个UCOSIII工程</span></a></li></ol></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright ©  2017  SunnyFHY</p>
<p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p>
<p style="font-size: 10px" id="footer-times" data-time="10/01/2018 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//初始日期
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
    show_date_time();
</script>

  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</body>
</html>
