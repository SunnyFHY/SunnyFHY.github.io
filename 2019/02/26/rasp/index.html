<!DOCTYPE html>
<html lang="null">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="符涵月">
  <meta name="description" content="南邮本科生">
  
  <title>SunnyFHY</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<link rel="shortcut icon" href="/source/favicon.ico">
</head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/Coconutree_Moon.jpg);background-color:#26A69A">
    <div class="header-box"><img src="/images/Spongebob.jpg" ondragstart="return false;"></div>
    <p>SunnyFHY</p>
    <div class="nav-link">
        
        
        <a  href="https://github.com/SunnyFHY" target="_blank"><div class="link-box github"></div></a>
        
        
        
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class='no-result'>无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2019/11/">November 2019<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2019/02/">February 2019<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/12/">December 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/10/">October 2018<span class="archive-count">3</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a   class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/VivadoHLS/">VivadoHLS<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/四旋翼/">四旋翼<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/操作系统/">操作系统<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/树莓派/">树莓派<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/通信仿真/">通信仿真<span class="category-count">2</span></a>
    </li>
</ul>
<!--tags-->

<!--photo-->

<!--friends-->

<!--about-->

<li class="nav-list">
    <a href="/about" target="_self">
        <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>关于</p>
    </a>
</li>


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#26A69A;background-image:url(/images/random/vateral-1.png)" >
  <h2>树莓派3b+ opencv3.4.1 QT USB摄像头 串口配置</h2>
    
  <p>作者:SunnyFHY &nbsp&nbsp 发布于:<time datetime="2019-02-26T01:30:14.000Z">
          2019-02-26
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <h1 id="树莓派3b-OpenCV3-4-1-USB摄像头-串口配置教程"><a href="#树莓派3b-OpenCV3-4-1-USB摄像头-串口配置教程" class="headerlink" title="树莓派3b+   OpenCV3.4.1    USB摄像头 串口配置教程"></a>树莓派3b+   OpenCV3.4.1    USB摄像头 串口配置教程</h1><p>本来这个教程写了个开头不打算写完的，感觉没啥意思。结果周末的时候配串口把系统搞崩了，所以重装就顺便记一下了。</p>
<p>首先记一下出错：配串口的时候在config文件里加了一行代码之后重启出现了kernel panic-not syncing:attempted to kill init!之后科协的同学教我把存储卡里的boot文件夹在PC上打开找到config.txt删掉多加的那行代码就可以重启了。不过后来始终配不起来串口，一改config就开始崩，反反复复操作了好几次最后直接boot文件夹都windows不可识别了。树莓派也重启不了啦。一直重装一直爽，愿天堂不需要编译OpenCV。</p>
<h2 id="材料及软件清单："><a href="#材料及软件清单：" class="headerlink" title="材料及软件清单："></a>材料及软件清单：</h2><p>Raspberry Pi 3b+     TF存储卡（大于8G）  读卡器    /     DiskImager    VNCViewer（csdn上都有安装包)</p>
<h2 id="树莓派系统-Paspbian-下载及烧录："><a href="#树莓派系统-Paspbian-下载及烧录：" class="headerlink" title="树莓派系统(Paspbian)下载及烧录："></a>树莓派系统(Paspbian)下载及烧录：</h2><p>1.进入<a href="https://www.raspberrypi.org/" target="_blank" rel="external">https://www.raspberrypi.org/</a></p>
<p>  点击导航栏Downloads</p>
<p><img src="/2019/02/26/rasp/1550199513711.png" alt="1550199513711"></p>
<p>2.选择Raspbian</p>
<p><img src="/2019/02/26/rasp/1550199744281.png" alt="1550199744281"></p>
<p>3.下载系统镜像压缩包（Dwonload ZIP），左上为带图形界面及推荐软件版，右上带图形界面，左下纯命令行</p>
<p><img src="/2019/02/26/rasp/1550199826769.png" alt="1550199826769"></p>
<p>4.下载后解压至任意路径（<strong>注意不能含有中文路径</strong>）</p>
<p>​    得到后缀为img的镜像文件</p>
<p>5.接下来打开 DiskImager烧录系统</p>
<p>   Device选择读卡器的U盘、ImageFile选择刚刚解压img镜像文件路径</p>
<p>   点击Write</p>
<p><img src="/2019/02/26/rasp/1550200210722.png" alt="1550200210722"></p>
<p>等待出现Write Successfully弹窗</p>
<p>6.插入烧录好Paspbian的存储卡，连接电源和显示器，等待开机。</p>
<p><strong>注意：</strong>初始系统设置弹窗注意看提示语，别一路NEXT，赶时间最后一步需要下载东西的check for update可以跳过</p>
<h2 id="vnc-server远程PC桌面登录树莓派（如果有需要的话）"><a href="#vnc-server远程PC桌面登录树莓派（如果有需要的话）" class="headerlink" title="vnc server远程PC桌面登录树莓派（如果有需要的话）"></a>vnc server远程PC桌面登录树莓派（如果有需要的话）</h2><p>其实vnc后期不能远程显示摄像头的图像框的，而且有时候画面还会卡。</p>
<p>1.首先确保PC和树莓派处在同一个网络下，在树莓派的命令行里输入vncserver</p>
<p>2.打开PC端的vncviewer输入树莓派显示的ip地址</p>
<p><img src="/2019/02/26/rasp/1551107426897.png" alt="1551107426897"></p>
<p>3.输入用户名和密码，用户名默认pi,密码为第一次开机自己设定的登录密码。</p>
<p><img src="/2019/02/26/rasp/1551107469951.png" alt="1551107469951"></p>
<p>4.获得PC远程图形桌面登录。</p>
<p><img src="/2019/02/26/rasp/1551107570897.png" alt="1551107570897"></p>
<h2 id="系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）"><a href="#系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）" class="headerlink" title="系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）"></a>系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）</h2><h2 id="NEXT——-gt"><a href="#NEXT——-gt" class="headerlink" title="NEXT——-&gt;"></a>NEXT——-&gt;</h2><h2 id="完整更新镜像源"><a href="#完整更新镜像源" class="headerlink" title="完整更新镜像源"></a>完整更新镜像源</h2><h4 id="1-备份"><a href="#1-备份" class="headerlink" title="1.备份"></a>1.备份</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</div><div class="line">sudo cp /etc/apt/sources.list.d/raspi.list /etc/apt/sources.list.d/raspi.list.bak</div></pre></td></tr></table></figure>
<hr>
<h4 id="2-修改软件更新源，用中科大站点："><a href="#2-修改软件更新源，用中科大站点：" class="headerlink" title="2.修改软件更新源，用中科大站点："></a>2.修改软件更新源，用中科大站点：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/apt/sources.list</div></pre></td></tr></table></figure>
<p>修改后如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ stretch main contrib non-free</div><div class="line"># Uncomment line below then &apos;apt-get update&apos; to enable &apos;apt-get source&apos;</div><div class="line">#deb-src http://archive.raspbian.org/raspbian/ stretch main contrib non-free rpi</div></pre></td></tr></table></figure>
<p>ctrl+o 保存 → 回车 确认 → ctrl+x 退出</p>
<hr>
<h4 id="3-再修改系统更新源："><a href="#3-再修改系统更新源：" class="headerlink" title="3.再修改系统更新源："></a>3.再修改系统更新源：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/apt/sources.list.d/raspi.list</div></pre></td></tr></table></figure>
<p>同样修改首行网址，修改后如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ stretch main ui</div><div class="line"># Uncomment line below then &apos;apt-get update&apos; to enable &apos;apt-get source&apos;</div><div class="line">#deb-src http://archive.raspberrypi.org/debian/ stretch main ui</div></pre></td></tr></table></figure>
<p>ctrl+o 保存 → 回车 确认 → ctrl+x 退出</p>
<hr>
<h3 id="4-更新"><a href="#4-更新" class="headerlink" title="4.更新"></a>4.更新</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update ; sudo apt-get upgrade ; sudo apt-get dist-upgrade ; sudo rpi-update</div></pre></td></tr></table></figure>
<p>此处为更新软件源列表、软件版本和内核版本，因为更新内容比较多，所以耗时长些（中间会需要多次选择y/n,10分钟警告+意外中断风险，需要关掉vnc）</p>
<h2 id="qt5下载及编译工具配置"><a href="#qt5下载及编译工具配置" class="headerlink" title="qt5下载及编译工具配置"></a>qt5下载及编译工具配置</h2><p>​           </p>
<ol>
<li>树莓派安装QT非常简单，只需要两句话，打开终端，输入以下命令</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install qt5-default</div><div class="line">sudo apt-get install qtcreator</div></pre></td></tr></table></figure>
<ol>
<li>一定要确保第一个安装成功了再输入第二个命令，如果安装第一个时提示需要xx依赖于xx，那么就把第一个命令改为</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo aptitude install qt5-default</div></pre></td></tr></table></figure>
<p>3.然后再输入上面的第二个命令</p>
<p>4.之后按下图进行编译工具配置</p>
<p><img src="/2019/02/26/rasp/70.png" alt="img"> </p>
<p><img src="/2019/02/26/rasp/1551144134510.png" alt="1551144134510"></p>
<p>compiler path: /usr/bin/arm-linux-gnueabihf-gcc</p>
<p><img src="/2019/02/26/rasp/1551144086897.png" alt="1551144086897"></p>
<h2 id="wiringpi配置"><a href="#wiringpi配置" class="headerlink" title="wiringpi配置"></a>wiringpi配置</h2><p>1.安装git工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git-core</div></pre></td></tr></table></figure>
<p>2.克隆wiringpi源码到本地并编译安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git clone git://git.drogon.net/wiringPi</div><div class="line"></div><div class="line">cd wiringPi</div><div class="line"></div><div class="line">./build</div></pre></td></tr></table></figure>
<p>3.更新wiringpi库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd wiringPi</div><div class="line"></div><div class="line">git pull origin</div></pre></td></tr></table></figure>
<h2 id="串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）"><a href="#串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）" class="headerlink" title="串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）"></a>串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）</h2><p>1.将树莓派的硬件串口与mini串口默认映射对换</p>
<p>简单来说：硬件串口由硬件实现，有单独波特率时钟源，性能高，可靠，而mini串口要依附CPU内核提供时钟。因此我们要用硬件串口，但是树莓派3b的硬件串口默认连接的是蓝牙，所以我们要改一下，把蓝牙映射到mini串口上，而释放硬件串口。</p>
<p>首先查看有没有相关文件</p>
<p>命令行 cd /boot/overlays</p>
<p>可以看到有 README 和 pi3-miniuart-bt-overlay.dtb 或者是 pi3-miniuart-bt.dtb ，后面的缺了(overlay)但是在README中的解释是相同的，因此，认为是同一文件。如果没有的话，参考博客 给出链接点击 <a href="http://ukonline2000.com/wp-content/uploads/2016/03/" target="_blank" rel="external">http://ukonline2000.com/wp-content/uploads/2016/03/</a> 下载。</p>
<p><img src="/2019/02/26/rasp/20180401182317939" alt="img"> </p>
<p><img src="/2019/02/26/rasp/20180401182328507" alt="img"> </p>
<p>README文件中说明了此文件的功能是将树莓派3的蓝牙切换到mini串口(ttyS0),并且恢复硬件串口(ttyAMA0)到GPIO14&amp;15引脚中。</p>
<p>2.查看并修改串口映射关系</p>
<p> 终端输入  ls -l /dev</p>
<p>红框里面表示串口映射，有的可能只显示1个，没关系，修改之后两个就都显示出来了。</p>
<p><img src="/2019/02/26/rasp/20180401183514718" alt="img"> </p>
<p>现在来修改</p>
<p>命令行sudo nano /boot/config.txt</p>
<p>在该文件中加一行代码  dtoverlay=pi3-miniuart-bt</p>
<p><img src="/2019/02/26/rasp/2018040118404049" alt="img"> </p>
<p>然后保存文件，重启树莓派。</p>
<p>然后我们再次查看 命令行 ls -l /dev  此时两个都有了并且对调了</p>
<p><img src="/2019/02/26/rasp/20180401184314320" alt="img"> </p>
<p>可以看出，硬件串口(ttyAMA0)映射到了GPIO Tx(14) Rx(15) 引脚上。</p>
<p>3.禁用串口的控制台功能。</p>
<p>前面步骤已经交换了硬件串口与mini串口的映射关系，但是，现在还不能使用树莓派串口模块与电脑进行通信，因为，树莓派io口引出串口默认是用来做控制台使用的，即是为了用串口控制树莓派，而不是通信。所以我们要禁用此默认设置。</p>
<p>两个命令</p>
<p>sudo systemctl stop serial-getty@ttyAMA0.service<br>sudo systemctl disable serial-getty@ttyAMA0.service</p>
<p>然后命令行</p>
<p>sudo nano /boot/cmdline.txt<br>删除语句 console=serial0,115200</p>
<p>保存之后内容如下，有的可能不一样</p>
<p><img src="/2019/02/26/rasp/20180401185342112" alt="img"> </p>
<p>然后重启树莓派，</p>
<p>配置结束。</p>
<p>接下来我们先配视觉处理环境，最后进行OpenCV、QT和串口的联合测试。</p>
<h2 id="OpenCV和摄像头配置"><a href="#OpenCV和摄像头配置" class="headerlink" title="OpenCV和摄像头配置"></a>OpenCV和摄像头配置</h2><p>首先安装构建OpenCV的相关工具:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential cmake git pkg-config</div></pre></td></tr></table></figure>
<p>  之后安装常用图像工具包：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 安装jpeg格式图像工具包</span></div><div class="line">sudo apt-get install libjpeg8-dev </div><div class="line"><span class="comment">// 安装tif格式图像工具包</span></div><div class="line">sudo apt-get install libtiff5-dev </div><div class="line"><span class="comment">// 安装JPEG-2000图像工具包</span></div><div class="line">sudo apt-get install libjasper-dev </div><div class="line"><span class="comment">// 安装png图像工具包</span></div><div class="line">sudo apt-get install libpng12-dev</div></pre></td></tr></table></figure>
<p>  再安装视频I/O包:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev</div></pre></td></tr></table></figure>
<p>  下面安装gtk2.0(此处如果不换源的话几乎100%失败,所以安装好系统后马上更换源):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libgtk2.0-dev</div></pre></td></tr></table></figure>
<p>  然后是优化函数包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libatlas-base-dev gfortran</div></pre></td></tr></table></figure>
<p>  到此为止,需要安装的依赖项全部完成了,接下来开始安装Opencv,我们采用源码编译的方式安装:（要很久= =）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#下载OpenCV</div><div class="line">wget -O opencv-3.4.1.zip https://github.com/Itseez/opencv/archive/3.4.1.zip  </div><div class="line"> </div><div class="line"># 解压OpenCV</div><div class="line">unzip opencv-3.4.1.zip</div></pre></td></tr></table></figure>
<p>  前面已经把源代码解压了,所以现在要切换到源码的文件夹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd opencv-3.4.1</div></pre></td></tr></table></figure>
<p>  新建一个名为build的文件夹用来存放cmake编译时产生的临时文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir build</div><div class="line">// 进入builf文件夹</div><div class="line">cd build</div></pre></td></tr></table></figure>
<p>  设置cmake编译参数，安装目录默认为/usr/local，在终端输入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/local ..</div></pre></td></tr></table></figure>
<p>   此过程中会下载部分文件,由于是外网,所以往往耗费较长时间,预计在十五分钟左右,请耐心等待</p>
<p>   cmake没问题的话,就可以继续下面的步骤,正式编译,继续输入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 编译，以管理员身份，否则容易出错,-j4用来加快编译速度</div><div class="line">sudo make -j4</div><div class="line">// 安装</div><div class="line">sudo make install</div><div class="line">// 更新动态链接库</div><div class="line">sudo ldconfig</div></pre></td></tr></table></figure>
<p> 在用opencv调用前，请先完成以下操作</p>
<p><img src="/2019/02/26/rasp/1551143333503.png" alt="1551143333503"></p>
<p><img src="/2019/02/26/rasp/1551143406955.png" alt="1551143406955"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nano /etc/modules-load.d/rpi-camera.conf</div></pre></td></tr></table></figure>
<p> 之后在最后一行上加上bcm2835-v4l2，这样就可以在opencv中调用官方的摄像头了</p>
<h2 id="OpenCV、QT和串口联合测试"><a href="#OpenCV、QT和串口联合测试" class="headerlink" title="OpenCV、QT和串口联合测试"></a>OpenCV、QT和串口联合测试</h2><p>   打开QtCreator，点击File，选择New File or Project，选择None-Qt Project,选择Plain C++ Project，点击choose ，然后基本都选默认的就行</p>
<p><img src="/2019/02/26/rasp/1547461824827032.png" alt="树莓派3B+安装QT及配置Opencv过程-杨幽科技"></p>
<p>  项目建立完成后在左栏就会看到一个*.pro文件，修改.pro文件中的内容，如下(直接复制即可)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">QT += core</div><div class="line">QT -= gui</div><div class="line"> </div><div class="line">TARGET = opencv_test</div><div class="line">CONFIG += console</div><div class="line">CONFIG -= app_bundle</div><div class="line"> </div><div class="line">INCLUDEPATH += /usr/local/include \</div><div class="line">                /usr/local/include/opencv \</div><div class="line">                /usr/local/include/opencv2</div><div class="line"> </div><div class="line">LIBS += /usr/local/lib/libopencv_calib3d.so //usr/local/lib/libopencv_core.so //usr/local/lib/libopencv_features2d.so //usr/local/lib/libopencv_flann.so //usr/local/lib/libopencv_highgui.so //usr/local/lib/libopencv_imgcodecs.so //usr/local/lib/libopencv_imgproc.so //usr/local/lib/libopencv_ml.so //usr/local/lib/libopencv_objdetect.so //usr/local/lib/libopencv_photo.so //usr/local/lib/libopencv_shape.so //usr/local/lib/libopencv_stitching.so //usr/local/lib/libopencv_superres.so //usr/local/lib/libopencv_videoio.so //usr/local/lib/libopencv_video.so //usr/local/lib/libopencv_videostab.so</div><div class="line"> </div><div class="line"> </div><div class="line">TEMPLATE = app</div><div class="line"> </div><div class="line">SOURCES += main.cpp</div><div class="line"></div><div class="line">LIBS +=-lwiringPi    #这个是wiringPi的库</div></pre></td></tr></table></figure>
<p>main.cpp内容如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wiringPi.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wiringSerial.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;  </div><div class="line"> </div><div class="line"><span class="comment">//-----------------------------------【main( )函数】--------------------------------------------</span></div><div class="line"><span class="comment">//      描述：控制台应用程序的入口函数，我们的程序从这里开始</span></div><div class="line"><span class="comment">//-------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( )</span>  </span></div><div class="line">&#123;  </div><div class="line">   </div><div class="line">     <span class="keyword">int</span> fd;</div><div class="line">     <span class="keyword">char</span> str[<span class="number">6</span>],str1[<span class="number">6</span>];</div><div class="line">     <span class="keyword">if</span>(wiringPiSetupSys()&lt;<span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>; <span class="comment">//初始化wiringPi</span></div><div class="line"></div><div class="line">     <span class="built_in">sprintf</span>(str,<span class="string">"%s%s%s"</span>,<span class="string">"X"</span>,<span class="string">"110"</span>,<span class="string">"R"</span>);</div><div class="line">     <span class="built_in">sprintf</span>(str1,<span class="string">"%s%s%s"</span>,<span class="string">"Y"</span>,<span class="string">"220"</span>,<span class="string">"R"</span>);<span class="comment">//字串拼接，%s可替換成int/float</span></div><div class="line">    <span class="comment">//【1】从摄像头读入视频</span></div><div class="line">    <span class="function">VideoCapture <span class="title">capture</span><span class="params">(<span class="number">0</span>)</span></span>;</div><div class="line">   </div><div class="line">    <span class="comment">//【2】循环显示每一帧</span></div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)  </div><div class="line">    &#123;  </div><div class="line">   </div><div class="line">    </div><div class="line">     Mat frame;  <span class="comment">//定义一个Mat变量，用于存储每一帧的图像</span></div><div class="line">     capture&gt;&gt;frame;  <span class="comment">//读取当前帧</span></div><div class="line">     imshow(<span class="string">"读取视频"</span>,frame);  <span class="comment">//显示当前帧</span></div><div class="line">     waitKey(<span class="number">10</span>); </div><div class="line">    </div><div class="line">    </div><div class="line">     <span class="keyword">if</span>((fd=serialOpen(<span class="string">"/dev/ttyAMA0"</span>,<span class="number">9600</span>))&lt;<span class="number">0</span>)</div><div class="line">       &#123;</div><div class="line">        <span class="keyword">int</span> time = millis();</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"serial doesn't open,return -1,time is %d"</span>,time);</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">         &#125;</div><div class="line">    serialPrintf(fd,str); </div><div class="line">    serialPrintf(fd,str1);</div><div class="line">    </div><div class="line">        </div><div class="line">    <span class="keyword">int</span> c = waitKey(<span class="number">10</span>);</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">char</span>)c == <span class="number">27</span>) &#123; <span class="keyword">break</span>; &#125; <span class="comment">// escape</span></div><div class="line"></div><div class="line">    </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;     </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="结果：测试成功！！！"><a href="#结果：测试成功！！！" class="headerlink" title="结果：测试成功！！！"></a>结果：测试成功！！！</h2><p>硬件连接不赘述，演示效果自己瞧，总之成功！！！</p>
<p>好了终于复活了。啊我活了，啊我又死了。过一会还要跑操，不过早上的课这周还没开始，所以要继续摸图像处理。我写这篇东西有啥意思呢？我现在就备份镜像，以后再也不白手又起家，卷土再重来了。配完环境的人，真的还能撑住写代码吗？？？</p>
<p>附备份镜像教程：</p>
<p>1.先右键新建一个文本文档，把它后缀名改成img。</p>
<p>2.使用diskimager软件选中刚刚新建的img文件路径。</p>
<p>3.点击read键将镜像读出。</p>
<p>参考网址：<a href="https://ayangyou.com/2019/01/24/raspberrypi_qt_opencv/" target="_blank" rel="external">https://ayangyou.com/2019/01/24/raspberrypi_qt_opencv/</a></p>
<p>​                  <a href="https://blog.csdn.net/qq_29781403/article/details/85093062" target="_blank" rel="external">https://blog.csdn.net/qq_29781403/article/details/85093062</a></p>
<p>​                  <a href="https://blog.csdn.net/u014415522/article/details/80645651" target="_blank" rel="external">https://blog.csdn.net/u014415522/article/details/80645651</a></p>
<p>​                   <a href="https://blog.csdn.net/qq_36326623/article/details/79780061" target="_blank" rel="external">https://blog.csdn.net/qq_36326623/article/details/79780061</a> </p>
<p>​                   <a href="https://www.itread01.com/content/1546097048.html" target="_blank" rel="external">https://www.itread01.com/content/1546097048.html</a></p>

  </div>
  <!--评论块-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2019/11/09/MATLAB1/" id="post_nav-newer" class="post-nav-content prev-content">
      新篇
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2018/12/10/ucosiii2/" id="post_nav-older" class="post-nav-content next-content">
      旧篇
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#树莓派3b-OpenCV3-4-1-USB摄像头-串口配置教程"><span class="post-toc-number">1.</span> <span class="post-toc-text">树莓派3b+   OpenCV3.4.1    USB摄像头 串口配置教程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#材料及软件清单："><span class="post-toc-number">1.1.</span> <span class="post-toc-text">材料及软件清单：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#树莓派系统-Paspbian-下载及烧录："><span class="post-toc-number">1.2.</span> <span class="post-toc-text">树莓派系统(Paspbian)下载及烧录：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#vnc-server远程PC桌面登录树莓派（如果有需要的话）"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">vnc server远程PC桌面登录树莓派（如果有需要的话）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">系统汉化教程（不存在的，这样编译报错都报中文我怎么查解决方案）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#NEXT——-gt"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">NEXT——-></span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#完整更新镜像源"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">完整更新镜像源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-备份"><span class="post-toc-number">1.6.0.1.</span> <span class="post-toc-text">1.备份</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-修改软件更新源，用中科大站点："><span class="post-toc-number">1.6.0.2.</span> <span class="post-toc-text">2.修改软件更新源，用中科大站点：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-再修改系统更新源："><span class="post-toc-number">1.6.0.3.</span> <span class="post-toc-text">3.再修改系统更新源：</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-更新"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">4.更新</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#qt5下载及编译工具配置"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">qt5下载及编译工具配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#wiringpi配置"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">wiringpi配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">串口配置（把这个放在前面，崩了我也不心疼，OpenCV编译放后面）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OpenCV和摄像头配置"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">OpenCV和摄像头配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#OpenCV、QT和串口联合测试"><span class="post-toc-number">1.11.</span> <span class="post-toc-text">OpenCV、QT和串口联合测试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结果：测试成功！！！"><span class="post-toc-number">1.12.</span> <span class="post-toc-text">结果：测试成功！！！</span></a></li></ol></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright ©  2017  SunnyFHY</p>
<p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p>
<p style="font-size: 10px" id="footer-times" data-time="10/01/2018 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//初始日期
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
    show_date_time();
</script>

  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
